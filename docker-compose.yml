networks:
  net:

#volumes:
#  pgdata:

services:

  vireo:
    container_name: vireo
    hostname: vireo
    image: ${IMAGE_HOST}/${SERVICE_PROJECT}/${SERVICE_PATH}:${IMAGE_VERSION}
    build:
      dockerfile: Dockerfile
      context: './'
    env_file:
       - .env
    volumes:
      - /opt/vireo:${APP_PATH}
    ports:
      - 9000:9000
    depends_on:
      - httpd
    networks:
      - net

  httpd:
    image: httpd:2.4-alpine
    # command: "/bin/sh -c 'while :; do sleep 6h & wait $${!}; nginx -s reload; done & nginx -g \"daemon off;\"'"
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - /opt/vireo/httpd:/etc/httpd/conf.d
      - /opt/vireo/certbot/conf:/etc/letsencrypt
      - /opt/vireo/www:/var/www/certbot
    networks:
      - net

  #certbot:
  #  image: certbot/certbot
  #  entrypoint: "/bin/sh -c 'trap exit TERM; while :; do certbot renew; sleep 12h & wait $${!}; done;'"
  #  volumes:
  #    - /opt/vireo/certbot/conf:/etc/letsencrypt
  #    - /opt/vireo/certbot/www:/var/www/certbot
  #  networks:
  #    - net
    